<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Panel – Traffic Quiz Results</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Admin CSS -->
  <link rel="stylesheet" href="admin.css">

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
</head>

<body>

<div class="admin-container">

  <!-- HEADER -->
  <div class="admin-header">
    <img src="logo.jpeg" class="logo" alt="Logo">
    <h1>Traffic Quiz – Admin Panel</h1>
    <p>Traffic Knowledge for Students</p>
  </div>

  <!-- TABLE -->
  <div class="table-wrapper">
    <table>
      <thead>
        <tr>
          <th>S.No</th>
          <th>Name</th>
          <th>Score</th>
          <th>Percentage</th>
          <th>Date & Time</th>
        </tr>
      </thead>
      <tbody id="resultsTable">
        <tr>
          <td colspan="5" style="text-align:center;">Loading results…</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- FOOTER -->
  <div class="admin-footer">
    © Telangana Traffic Police – Educational Purpose Only
  </div>

</div>

<script>
  /************************************************
   * FIREBASE INIT (ADMIN READ-ONLY)
   ************************************************/
  const firebaseConfig = {
    apiKey: "AIzaSyAJT61cprsH6Zxsv4xvubfMnKlk3XSq3gE",
    authDomain: "traffic-quiz-6eaa3.firebaseapp.com",
    projectId: "traffic-quiz-6eaa3",
    storageBucket: "traffic-quiz-6eaa3.firebasestorage.app",
    messagingSenderId: "1011063341314",
    appId: "1:1011063341314:web:2f4602a1dd1887d3b0821b"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  /************************************************
   * LOAD RESULTS
   ************************************************/
  const table = document.getElementById("resultsTable");
  let count = 1;

  db.collection("results")
    .orderBy("createdAt", "desc")
    .get()
    .then(snapshot => {
      table.innerHTML = "";

      if (snapshot.empty) {
        table.innerHTML = `
          <tr>
            <td colspan="5" style="text-align:center;">
              No results found
            </td>
          </tr>
        `;
        return;
      }

      snapshot.forEach(doc => {
        const d = doc.data();

        const dateText = d.createdAt
          ? d.createdAt.toDate().toLocaleString()
          : "—";

        const percentage = d.percentage !== undefined
          ? d.percentage + "%"
          : "—";

        const row = `
          <tr>
            <td>${count++}</td>
            <td>${d.name || "—"}</td>
            <td class="score">${d.score} / ${d.total}</td>
            <td>${percentage}</td>
            <td>${dateText}</td>
          </tr>
        `;

        table.innerHTML += row;
      });
    })
    .catch(error => {
      console.error("Admin Firestore error:", error);
      table.innerHTML = `
        <tr>
          <td colspan="5" style="text-align:center;color:red;">
            Failed to load results
          </td>
        </tr>
      `;
    });
</script>

</body>
</html>
